{
    "url": "https://www.appdome.com/how-to/mobile-bot-detection/technology-partners-integrations/configuring-irules-for-custom-traffic-management-on-f5-session-headers",
    "title": "Configuring iRules for Custom Traffic Management on F5 (Session Headers)",
    "content": "Configuring iRules for Custom Traffic Management on F5 (Session Headers)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n![](https://pubads.g.doubleclick.net/activity;xsp=4798079;ord=1?)\n\n\n\n ![](https://px.ads.linkedin.com/collect/?pid=3167484&fmt=gif)\n\n\n\n\nMenu\n\n[Sign In](https://fusion.appdome.com/login)\n\n[![Appdome Logo](https://www.appdome.com/wp-content/uploads/elementor/thumbs/appdome-logo-r88bnmyou58sjra0z25z48awn6epdjpr0vb010dhxc.png \"Appdome Logo\")](/)\n\n[How to](https://www.appdome.com/how-to/) \n > \n[Mobile Bot Defense](https://www.appdome.com/how-to/mobile-bot-detection/)\n > \n[Technology Partners & Integrations](https://www.appdome.com/how-to/mobile-bot-detection/technology-partners-integrations/)\n > \n[Configuring iRules for Custom Traffic Management on F5 (Session Headers)](https://www.appdome.com/how-to/mobile-bot-detection/technology-partners-integrations/configuring-irules-for-custom-traffic-management-on-f5-session-headers/)\n\n# Configuring iRules for Custom Traffic Management on F5 (Session Headers)\n\nLast updated July 31, 2025 by Appdome\n\nF5 iRules provides a toolset within the F5 BIG-IP platform, specifically with the Local Traffic Manager (LTM), for dynamic control and manipulation of network traffic. iRules utilize a scripting language based on TCL (Tool Command Language), which allows administrators to direct, inspect, and modify the traffic passing through the network in real time. The capability to implement custom logic and manage traffic based on specific network and application conditions makes iRules an essential component for customized traffic management solutions.\n\nHere\u2019s a basic rundown of what iRules can do with this scripting capability:\n\n**Inspect traffic:** iRules can examine the data passing through the network, such as URLs, headers, and payloads, to make decisions based on what the data contains.\n\n**Direct traffic:** Based on the inspection, iRules can route traffic to different servers or destinations. This is useful for load balancing, ensuring that no single server gets overwhelmed.\n\n**Manipulate traffic:** iRules can modify the data in transit, such as changing headers, rewriting URLs, or even blocking certain requests entirely.\n\nThis capability makes iRules an essential tool for customizing how traffic is handled on a network, ensuring that specific business rules or security protocols are adhered to.\n\n### **Key Definitions for Session Management**\n\n* **Safe Session:** Sessions identified as secure and free from any threats.\n* **At-Risk Session:** Sessions that are potentially compromised or exhibiting unusual behavior.\n* **Header Payload:** The data within HTTP request or response headers is crucial for maintaining the integrity of transmitted information.\n\n### **iRules Configuration Steps**\n\nAppdome\u2019s iRules for F5 are designed to enhance security and manage sessions more effectively. Below is an explanation of what each provided iRule does.\n\n1. Navigate to *Local Traffic* -> *iRules -> iRule List*\n2. Select Create by clicking on the + sign button.\n3. Give the iRule a name, such as my\\_irule. The full pathname of the iRule cannot exceed 255 characters or contain spaces.\n4. Paste the provided iRules\n\n**Nonce Validation:** Checks if the nonce has already been used to prevent replay attacks.\n\n```\n # Validate that the nonce has not been reused.\r\n    if { [table lookup -notouch $NONCE] != \"\" } {\r\n        if { $logs_on == 1 && $log_levels($log_level) <= $log_levels(INFO) } {\r\n            log local0. \"INFO NONCE used - rejecting [IP::client_addr]\"\r\n        }\r\n        # Check passthrough mode before rejecting\r\n        if { $passthrough_mode == 1 || $disable_nonce_validation == 1 } {\r\n            if { $logs_on == 1 && $log_levels($log_level) <= $log_levels(INFO) } {\r\n                log local0. \"INFO Passthrough mode enabled, bypassing NONCE reuse check.\"\r\n            }\r\n            pool /Common/Pool-AppDome\r\n            return\r\n        }\r\n        HTTP::respond 409 content \"NONCE used\"\r\n        return\r\n    }\n```\n\n**Timestamp Validation:** Ensures that the request is not replayed outside a valid time window.\n\n```\n # Get the current time and calculate the time difference.\r\n    set now [clock seconds]\r\n    set heartbeat_validity {{HEARTBEAT_VALIDITY}}\r\n    set time_elapsed [expr { $now - $TIMESTAMP }]\r\n\r\n    # Validate timestamp: if expired, log and handle according to passthrough mode.\r\n    if { $time_elapsed > $heartbeat_validity } {\r\n        if { $logs_on == 1 && $log_levels($log_level) <= $log_levels(INFO) } {\r\n            log local0. \"INFO Heartbeat expired\"\r\n        }\r\n        # Check passthrough mode before rejecting\r\n        if { $passthrough_mode == 1 || $disable_timestamp_validation == 1} {\r\n            if { $logs_on == 1 && $log_levels($log_level) <= $log_levels(INFO) } {\r\n                log local0. \"INFO Passthrough mode enabled, bypassing heartbeat expiration check.\"\r\n            }\r\n            pool /Common/Pool-AppDome\r\n            return\r\n        }\r\n        HTTP::respond 408 content \"Heartbeat expired\"\r\n        return\r\n    }\n```\n\n**Missing values**\n\n```\n# Check if any required values are missing.\r\n    if { $TIMESTAMP == \"\" || $NONCE == \"\" || $SIGNEDMESSAGE == \"\" } {\r\n        if { $logs_on == 1 && $log_levels($log_level) <= $log_levels(INFO) } {\r\n            log local0. \"INFO Missing values!\"\r\n        }\r\n        # Check passthrough mode before rejecting\r\n        if { $passthrough_mode == 1 } {\r\n            if { $logs_on == 1 && $log_levels($log_level) <= $log_levels(INFO) } {\r\n                log local0. \"INFO Passthrough mode enabled, bypassing missing values check.\"\r\n            }\r\n            pool /Common/Pool-AppDome\r\n            return\r\n        }\r\n        HTTP::respond 412 content \"Missing values\"\r\n        return\r\n    }\n```\n\n**Add an iRule to your virtual server**\n\n1. Go to Local Traffic > Virtual Servers.\n2. Select the virtual server you to which you want to apply the iRule.\n3. Select Resources tab.\n4. Select Manage\n5. Select the iRule you just created from Available list and move it to the Enabled list.\n6. Select Finished.\n\n![96](https://www.appdome.com/wp-content/uploads/2023/10/96.png)\n\n## Related Articles:\n\n* [MobileBOT\u2122 Defense](https://appdome.com/how-to/mobile-fraud-prevention-detection/mobile-bot-detection/mobilebot-detection/?__hstc=267077713.6777b3fda0d62b04a09a73f1ca303fcd.1718886927298.1729407356686.1729409421879.260&__hssc=267077713.27.1729409421879&__hsfp=203575498)\n* [Using F5 WAF with Appdome MobileBOT\u2122 Defense](https://www.appdome.com/how-to/mobile-fraud-prevention-detection/mobile-bot-detection/integrating-f5-waf-with-appdome-for-enhanced-mobile-app-security/)\n* [How to Use Session Headers in Mobile Bot Defense](https://www.appdome.com/how-to/mobile-bot-detection/mobile-bot-defense/use-session-headers-in-mobile-bot-defense/)\n\n### How Do I Learn More?\n\nIf you have any questions, please send them our way at\u00a0**[support.appdome.com](http://support.appdome.com/?__hstc=267077713.6777b3fda0d62b04a09a73f1ca303fcd.1718886927298.1729407356686.1729409421879.260&__hssc=267077713.27.1729409421879&__hsfp=203575498)**\u00a0or via the chat window on the Appdome platform.\n\n### Thank you!\n\nThanks for visiting\u00a0[Appdome](https://www.appdome.com/?__hstc=267077713.6777b3fda0d62b04a09a73f1ca303fcd.1718886927298.1729407356686.1729409421879.260&__hssc=267077713.27.1729409421879&__hsfp=203575498)! Our mission is to secure every app on the planet by making mobile app defense easy. We hope we\u2019re living up to the mission with your project.\u00a0If you don\u2019t already have an account, you can\u00a0[sign up for free](https://fusion.appdome.com/?__hstc=267077713.6777b3fda0d62b04a09a73f1ca303fcd.1718886927298.1729407356686.1729409421879.260&__hssc=267077713.27.1729409421879&__hsfp=203575498).\n\nWant a Demo?\n\nTechnology Partners & Integrations\n\n![](https://www.appdome.com/wp-content/uploads/2020/10/Alan_Bavosa_B.jpg)\n\nAlanWe're here to help\n\n\n\n\nWe'll get back to you in 24 hours to schedule your demo.\n\n* [Home Page](https://www.appdome.com/)\n* [Dev+Sec Blog](https://www.appdome.com/dev-sec-blog/)\n* [Request A Demo](https://www.appdome.com/request-a-demo/appdome-home/)\n* [Platform](https://www.appdome.com/devsecops-tool-cicd/)\n* [Pricing](https://www.appdome.com/appdome-pricing/)\n* [About](https://www.appdome.com/about/)\n* [Patents](https://www.appdome.com/legal/patents/)\n* [Knowledge Base](https://www.appdome.com/how-to/)\n* [In The News](https://www.appdome.com/in-the-news/)\n* [Careers we\u2019re hiring!](https://www.appdome.com/about/work-at-appdome/)\n* [Terms Of Use](https://www.appdome.com/legal/terms-of-use/)\n* [Press Releases](https://www.appdome.com/press-releases/)\n* [Privacy Policy](https://www.appdome.com/legal/privacy-policy/)\n* [Contact Us](https://www.appdome.com/contact-us/)\n\n\n\n---\n\nREDWOOD CITY OFFICE\n\n* 3 Twin Dolphin Drive,   \n  Suite 375 Redwood City,   \n  CA 94065\n* Phone: [+1.650.567.6100](tel:+16505676100)   \n  Mobile: [+1.844.360.FUSE (3873)](tel:+1844360FUSE (3873))   \n  Email: [info@appdome.com](mailto:info@appdome.com)\n\nISRAEL OFFICE\n\n* 21 HaArba'a Street,\n* Phone: [+97235568332](tel:+97235568332)   \n  Email: [info@appdome.com](mailto:info@appdome.com)\n\nSearch for:\n\nFollow us\n\n\u00a92026 Appdome, Inc. All rights reserved. This Website requires the use of technical cookies and, with your consent, profiling, and third-party analytics to improve your experience.  \n If you continue to use our Website, or by clicking any items of our Website, you agree to this.\n\nWe use cookies to ensure that we give you the best experience on our website.\nIf you continue to use this site we will assume that you are happy with it.\nOk\n\n ![](https://px.ads.linkedin.com/collect/?pid=3167484&fmt=gif) \n\n## Search Appdome Solutions\n\nSearch\n\nSearch\n\n[![mobile app protection best practices](https://www.appdome.com/wp-content/uploads/2026/01/Mobile-App-Protection-Best-Practices-for-Developers-in-2026-170x111.png)](https://www.appdome.com/dev-sec-blog/mobile-app-protection-best-practices-for-developers/)\n\n### [Mobile App Protection Best Practices for Developers in 2026](https://www.appdome.com/dev-sec-blog/mobile-app-protection-best-practices-for-developers/)\n\nMobile app protection best practices for developers in 2026. Learn how to protect apps from AI malware, bots, ATO, and fraud \u2014 automated with Appdome.\n\nJan Sysmans \n\nJanuary 5, 2026\n\n[![Mobile App Attack Vectors](https://www.appdome.com/wp-content/uploads/2026/01/mobile-app-attack-vectors-170x111.png)](https://www.appdome.com/dev-sec-blog/top-mobile-app-attack-vectors/)\n\n### [Top 10 Mobile App Attack Vectors in 2026 And the Defense Architecture Required to Stop Them](https://www.appdome.com/dev-sec-blog/top-mobile-app-attack-vectors/)\n\nAI malware, deepfakes, and automated bots are the top mobile app attack vectors in 2026. Discover how to stop them with Appdome\u2019s defense architecture defense.\n\nJan Sysmans \n\nJanuary 1, 2026\n\n[![G2 Customer Reviews](https://www.appdome.com/wp-content/uploads/2025/12/G2-Reviews_-2025-Was-a-Banner-Year-for-Appdome-170x111.png)](https://www.appdome.com/dev-sec-blog/g2-customer-reviews-2025-banner-year-appdome/)\n\n### [G2 Customer Reviews Reveal 2025 Was a Banner Year for Appdome](https://www.appdome.com/dev-sec-blog/g2-customer-reviews-2025-banner-year-appdome/)\n\nG2 customer reviews show that 2025 marked a pivotal year for Appdome. The platform gained momentum as enterprises standardized on AI-native automation for mobile security, fraud prevention, and bot defense.\n\nTom Tovar \n\nDecember 28, 2025\n\n[![Android Bootloader Integrity Explained](https://www.appdome.com/wp-content/uploads/2025/12/android-bootloader-integrity-explained-170x111.png)](https://www.appdome.com/dev-sec-blog/android-bootloader-integrity-explained/)\n\n### [Why \u2018Unlocked Bootloader\u2019 Is a Broken Android Security Model](https://www.appdome.com/dev-sec-blog/android-bootloader-integrity-explained/)\n\nAndroid bootloader integrity is often reduced to a locked or unlocked state. This article explains why that model fails and how contextual bootloader signals improve identity and session trust.\n\nLiron Dror \n\nDecember 24, 2025\n\n[Dev+Sec Blog](/dev-sec-blog)\n\n-->"
}