{
    "url": "https://www.appdome.com/how-to/mobile-bot-detection/technology-partners-integrations/configure-appdomes-docker-image",
    "title": "Appdome | How to Configure Appdome\u2019s Docker Image for MobileBOT\u2122 Defense",
    "content": "Appdome | How to Configure Appdome\u2019s Docker Image for MobileBOT\u2122 Defense\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n![](https://pubads.g.doubleclick.net/activity;xsp=4798079;ord=1?)\n\n\n\n ![](https://px.ads.linkedin.com/collect/?pid=3167484&fmt=gif)\n\n\n\n\nMenu\n\n[Sign In](https://fusion.appdome.com/login)\n\n[![Appdome Logo](https://www.appdome.com/wp-content/uploads/elementor/thumbs/appdome-logo-r88bnmyou58sjra0z25z48awn6epdjpr0vb010dhxc.png \"Appdome Logo\")](/)\n\n[How to](https://www.appdome.com/how-to/) \n > \n[Mobile Bot Defense](https://www.appdome.com/how-to/mobile-bot-detection/)\n > \n[Technology Partners & Integrations](https://www.appdome.com/how-to/mobile-bot-detection/technology-partners-integrations/)\n > \n[How to Configure Appdome\u2019s Docker Image for MobileBOT\u2122 Defense](https://www.appdome.com/how-to/mobile-bot-detection/technology-partners-integrations/configure-appdomes-docker-image/)\n\n# How to Configure Appdome\u2019s Docker Image for MobileBOT\u2122 Defense\n\nLast updated July 31, 2025 by Appdome\n\nNow that you\u2019ve completed the setup of your preferred server (e.g., GCP, Azure, AWS) and configured your WAF (e.g., Imperva), you\u2019re ready to configure the Appdome Docker Image. This guide will walk you through the necessary steps to ensure that your Appdome MobileBOT\u2122 Defense solution is properly integrated and operational within your Docker environment.\n\nAppdome\u2019s Docker Image is a custom solution designed to secure apps built on the Appdome platform with the Anti-Bot service enabled. This service operates within a Docker container based on Nginx. To facilitate its operation, users must supply an SSL certificate, configuration files and keys, and designated environment variables.\n\n**Prerequisites**: Familiarity with Docker and UNIX-based machines is beneficial.\n\n## How Does It Work?\n\nBased on Nginx and Lua, the service employs the Lua module to decrypt the payload and validate the signature, then it proxies the request to the target route as specified in the config file.\n\nThe module can be used with either the built-in LRU cache or with Redis, but it is recommended to use the built-in LRU to reduce the overhead of making the calls to Redis and ease the setup. If working in a cluster, it is necessary to use Redis to share storage across multiple instances.\n\n## Setup\n\nThe following environment variables are required to set up the service.\n\n|  |  |  |\n| --- | --- | --- |\n| **Environment Variable Name** | **Required** | **Description** |\n| REDIS | Optional | Only provide AD\\_REDIS\\_HOST if you intend to use it. |\n| LOG\\_LEVEL | Optional | The default setting is warn. Available options include: debug, info, notice, warn, error, crit, alert, emerg. All logs are output to the stdout. |\n| RESOLVER | Mandatory | Provide the resolver DNS server to use for discovering upstream servers. |\n| PASSTHROUGH | Optional | A key that logs only headers but does not validate them. |\n| USE\\_DEFAULT | Optional | If the default.json config file is passed in the configs folder and this variable is passed as true, only the default configuration will be used. This is meant for testing purposes without constantly updating the config file. |\n\n**Note:**\u00a0For a Kubernetes server, the default DNS server IP is 192.168.0.10. For a pure Docker configuration, the default server IP is 127.0.0.11\n\n1. Receive the JSON config file\n\n* Obtain the JSON config file from our Appdome support team. The files will be named after the\u00a0`taskID`\u00a0of that build. There may be multiple files, each corresponding to different tasks.\n\n2. Modify the JSON config file\n\n* Add the following fields:\n  + key: The filename of the key that is relative to the\u00a0/home\u00a0folder in your docker container used for validation.\n  + target: The endpoint to which requests are forwarded. Make sure your DNS resolver resolves this address.\n  + heartbeat\\_validity\u00a0(optional): Time in seconds for how long the heartbeat remains valid.\n\nExample:\n\n```\n[{\r\n\r\n\"key\": \"keys/your_key_file.key\",\r\n\r\n\"target\": \"http://target_address\",\r\n\r\n\"heartbeat_validity\": 60\r\n\r\n...\r\n\r\n}]\n```\n\n3. Prepare the Docker Container:  \n\u2013 Ensure your Docker container has the necessary directories (`/home/configs` and `/home/keys`).\n\n* Configs Directory: This directory will store JSON files containing mobile anti-bot configurations provided by Appdome.\n* Keys Directory: This directory will store private keys used to validate the headers sent by Appdome.\n\n**Note:**Ensure Key Matches. Verify that the key specified in the JSON config file correctly points to a key file located in the `/home/keys` directory within the Docker container.\n\n**Note:**If you want to use only one config file for multiple task\\_ids for testing, rename the config file to\u00a0`default.json`\u00a0file and set the environment variable\u00a0`USE_DEFAULT=true`. This setup is useful for initial testing but is not recommended for production if you regularly change the Anti-bot configuration.\n\n4. Mount the JSON config file to the Docker Container\n\n* Use the `docker run` command with the `-v` option to bind mount the host directories to the container directories.\n\nBy following these steps, you\u2019ll be able to correctly set up and mount the JSON config file to your Appdome Docker container.\n\n### Optional: How to Configure SSL & mTLS\n\nIf you want the Appdome Docker Image to handle SSL and mTLS, additional configuration is required. This includes passing environment variables and mounting certificates to the service.\n\n|  |  |\n| --- | --- |\n| **Environment Variable Name** | **Description** |\n| SSL\\_ON | In order to enable the reverse proxy to handle SSL connections, you need to mark the SSL\\_ON=true. Make sure to mount SSL certificates to the container under\u00a0/etc/nginx/certs/{ssl.crt, key.key}. |\n| MTLS\\_ON | In order to enable the reverse proxy to handle mTLS, you need to set both SSL\\_ON and MTLS\\_ON=true.  Make sure to mount the CA certificate that will be used for the mTLS under\u00a0/etc/nginx/certs/ca.crt. |\n| FINGERPRINTS | If MTLS\\_ON=true the certificate fingerprints can be passed to allow only specific certificates identified by a SHA1 fingerprint. The value format should include a string of comma-separated values with a space following each comma as follows:\u00a0asd, zxc, qwe |\n\n## How to run Appdome Docker Image\n\nConnect to your VM, and run the following commands:\n\n* Pull the docker image from our public repository:\n\n```\ndocker pull public.ecr.aws/n2i7f1e2/appdome-waf:1.0.10\n```\n\n* Run the docker image with the following command:\n\n```\ndocker run -p 443:443 -p 80:80 -d \\\r\n-v \"$(pwd)\"/certs:/etc/nginx/certs \\\r\n-v \"$(pwd)\"/keys:/home/keys \\\r\n-v \"$(pwd)\"/configs:/home/configs \\\r\n-e REDIS=<redis address> \\\r\n-e PASSTHROUGH=false \\\r\n-e RESOLVER=<resolver address> \\\r\n-e SSL_ON=true \\\r\n-e MTLS_ON=true \\\r\n-e FINGERPRINTS=asd, zxc, qwe \\\r\n-e LOG_LEVEL=debug \\\r\n--restart unless-stopped \\\r\npublic.ecr.aws/n2i7f1e2/appdome-waf:1.0.10\n```\n\nAt this point, you have a machine that will run the Appdome Docker Image. Make sure that your application traffic is routing correctly to the Appdome Docker Image and that the Appdome Docker Image is passing the traffic correctly to the target.\n\n### Monitoring Docker Health\n\nTo ensure your Docker container is operational, it is essential to configure a health check endpoint within your system\u2019s monitoring tools. Set up an endpoint in your health monitoring system to regularly check the /\\_health endpoint of the Docker container. This setup helps confirm that the Docker container is running correctly and is responsive. You can use any system that supports health checks, ensuring it aligns with your deployment environment and monitoring needs.\n\n**Note:** The health check only verifies that the docker is up and running, but it does not confirm that the target is accessible. If you want to make sure that the connectivity between the reverse proxy and the target is working as expected, configure an additional health check that monitors the target connectivity.\n\n### Frequently Asked Questions (FAQ)\n\n**Question: Are timestamp and nonce enforcement enabled by default in Appdome\u2019s Docker Image?**  \n**Answer:** Yes, both timestamp and nonce enforcement are enabled by default to enhance security measures. If you wish to disable these features, set the environment variables `DISABLE_TIMESTAMP_ENFORCE` and `DISABLE_NONCE_ENFORCE` to \u201ctrue\u201d.\n\n### Log Information\n\nAppdome\u2019s Docker Image utilizes structured logging to ensure transparency and ease of monitoring. Logs are formatted as follows:\n\n```\n<timestamp> [<log level>]: [lua] <file><line number>: <function>: [<request_id>] [<client ip> - <user agent> - <request uri>] [<message>]\n```\n\nThis format helps pinpoint issues with precision, tracking the logs back to the exact file, line number, and function where the event was logged. The inclusion of client IP, user agent, and request URI provides a comprehensive context for each entry.\n\n### Additional Options:\n\nThis section explains how to configure custom exit rules for handling session requests using the Appdome Docker Image. By utilizing the handle file, users can specify behavior for different scenarios based on the request headers.\n\n**Setting Up the Handle File**\n\n* Provide a handle file under `/home/lua/handle.lua`.\n* This Lua script will determine the routing instructions (e.g., pass through or block) for each request based on the specified conditions.\n\n**Structure of the Handle File**\n\n* To write custom exit rules, create the following folder structure:\n\n  ```\n  \u279c\u00a0\u00a0lua git:(master) \u2717 tree .\r\n  .\r\n  \u251c\u2500\u2500 src\r\n  \u2502\u00a0\u00a0 \u2514\u2500\u2500 handle.lua\r\n  \u2514\u2500\u2500 wrapper.lua\n  ```\n\n**Writing Custom Rules in Handle.lua**:\n\n* Implement functions within `handle.lua` for different request scenarios such as VALID, COMPROMISED, COULD\\_NOT\\_DECRYPT, and INVALID:\n* Each function should return a boolean indicating whether the request is allowed, a corresponding HTTP status code, and a response body if applicable.\n\n  ```\n  local M = {}\r\n  -- Handle the response based on the case, returning the appropriate values\r\n  -- First return value is a boolean indicating if the request is valid, the second is the status code and the third is the body\r\n  -- @return boolean, number, string\r\n  M.handle_response = function(ngx, case, external_ids)\r\n  \u00a0\u00a0local cases = {\r\n  \u00a0\u00a0\u00a0\u00a0[\"VALID\"] = function()\r\n  \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ngx.log(ngx.DEBUG, \"Valid request\")\r\n  \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return true\r\n  \u00a0\u00a0\u00a0\u00a0end,\r\n  \u00a0\u00a0\u00a0\u00a0[\"COMPROMISED\"] = function()\r\n  \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0-- extrernal_ids are comma separated string of ids\r\n  \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ngx.log(ngx.DEBUG, \"Compromised request\")\r\n  \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ngx.log(ngx.DEBUG, \"External ids: \" .. (external_ids or \"\"))\r\n  \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return false, 400, \"\"\r\n  \u00a0\u00a0\u00a0\u00a0end,\r\n  \u00a0\u00a0\u00a0\u00a0[\"COULD_NOT_DECRYPT\"] = function()\r\n  \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ngx.log(ngx.DEBUG, \"Invalid request - could not decrypt signed message\")\r\n  \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return false, 400, \"\"\r\n  \u00a0\u00a0\u00a0\u00a0end,\r\n  \u00a0\u00a0\u00a0\u00a0[\"INVALID\"] = function()\r\n  \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ngx.log(ngx.DEBUG, \"Invalid request - derypted correctly but not valid or compromised\")\r\n  \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return false, 400, \"\"\r\n  \u00a0\u00a0\u00a0\u00a0end,\r\n  \u00a0\u00a0\u00a0\u00a0default = function()\r\n  \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0ngx.log(ngx.DEBUG, \"Unknown case: \" .. string(case))\r\n  \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0return false, 400, \"\"\r\n  \u00a0\u00a0\u00a0\u00a0end,\r\n  \u00a0\u00a0}\r\n  \u00a0\u00a0-- Execute the matching case or the default\r\n  \u00a0\u00a0local caseFunc = cases[case] or cases.default\r\n  \u00a0\u00a0return caseFunc()\r\n  end\r\n  return M\r\n  ```\n\n**Testing the Handle File**\n\n* Use `wrapper.lua` to test the `handle.lua` script. This testing should be done using a plain Lua interpreter, independent of OpenResty, to ensure that the script operates correctly in isolation.\n* This testing step is vital to verify the script\u2019s ability to manage all specified cases effectively and handle external IDs received from the requests:\n\n  ```\n  local handle = require(\"src.handle\")\r\n  local log = function(level, msg)\r\n  \u00a0\u00a0print(string.format(\"[%s] %s\", level, msg))\r\n  end\r\n  local check = function()\r\n  \u00a0\u00a0local ngx = { log = log, DEBUG = \"DEBUG\", INFO = \"INFO\" }\r\n  \u00a0\u00a0handle.handle_response(ngx, \"VALID\")\r\n  \u00a0\u00a0handle.handle_response(ngx, \"COULD_NOT_DECRYPT\")\r\n  \u00a0\u00a0handle.handle_response(ngx, \"INVALID\")\r\n  \u00a0\u00a0handle.handle_response(ngx, \"COMPROMISED\")\r\n  end\r\n  check()\n  ```\n\n## Related Articles:\n\n* [MobileBOT\u2122 Defense](https://appdome.com/how-to/mobile-fraud-prevention-detection/mobile-bot-detection/mobilebot-detection/)\n* [Using Akamai WAF with Appdome MobileBOT\u2122 Defense](https://www.appdome.com/how-to/mobile-fraud-prevention-detection/mobile-bot-detection/integrate-appdomes-docker-image-with-akamais-waf-for-enhanced-mobile-app-security/)\n* [How to Secure Android & iOS Apps in Azure DevOps Pipelines](https://appdome.com/how-to/devsecops-automation-mobile-cicd/mobile-app-security-anti-fraud-cicd/use-appdome-build-2secure-in-azure-pipelines/?__hstc=79098507.91fc95729d70bf17116f5cc6b5197e82.1683812569933.1697004449254.1697018033743.250&__hssc=79098507.5.1697018033743&__hsfp=3406240815)\n* [Using F5 WAF with Appdome MobileBOT\u2122 Defense](https://www.appdome.com/how-to/mobile-fraud-prevention-detection/mobile-bot-detection/integrating-f5-waf-with-appdome-for-enhanced-mobile-app-security/)\n\n### How Do I Learn More?\n\nIf you have any questions, please send them our way at\u00a0**[support.appdome.com](http://support.appdome.com/)**\u00a0or via the chat window on the Appdome platform.\n\n### Thank you!\n\nThanks for visiting\u00a0[Appdome](https://www.appdome.com/?__hstc=79098507.91fc95729d70bf17116f5cc6b5197e82.1683812569933.1697004449254.1697018033743.250&__hssc=79098507.5.1697018033743&__hsfp=3406240815)! Our mission is to secure every app on the planet by making mobile app defense easy. We hope we\u2019re living up to the mission with your project.\u00a0If you don\u2019t already have an account, you can\u00a0[sign up for free](https://fusion.appdome.com/?__hstc=79098507.91fc95729d70bf17116f5cc6b5197e82.1683812569933.1697004449254.1697018033743.250&__hssc=79098507.5.1697018033743&__hsfp=3406240815).\n\nWant a Demo?\n\nTechnology Partners & Integrations\n\n![](https://www.appdome.com/wp-content/uploads/2020/02/Appdome_Team_Photos_Gil_Hartman_BW.jpg)\n\nGilWe're here to help\n\n\n\n\nWe'll get back to you in 24 hours to schedule your demo.\n\n* [Home Page](https://www.appdome.com/)\n* [Dev+Sec Blog](https://www.appdome.com/dev-sec-blog/)\n* [Request A Demo](https://www.appdome.com/request-a-demo/appdome-home/)\n* [Platform](https://www.appdome.com/devsecops-tool-cicd/)\n* [Pricing](https://www.appdome.com/appdome-pricing/)\n* [About](https://www.appdome.com/about/)\n* [Patents](https://www.appdome.com/legal/patents/)\n* [Knowledge Base](https://www.appdome.com/how-to/)\n* [In The News](https://www.appdome.com/in-the-news/)\n* [Careers we\u2019re hiring!](https://www.appdome.com/about/work-at-appdome/)\n* [Terms Of Use](https://www.appdome.com/legal/terms-of-use/)\n* [Press Releases](https://www.appdome.com/press-releases/)\n* [Privacy Policy](https://www.appdome.com/legal/privacy-policy/)\n* [Contact Us](https://www.appdome.com/contact-us/)\n\n\n\n---\n\nREDWOOD CITY OFFICE\n\n* 3 Twin Dolphin Drive,   \n  Suite 375 Redwood City,   \n  CA 94065\n* Phone: [+1.650.567.6100](tel:+16505676100)   \n  Mobile: [+1.844.360.FUSE (3873)](tel:+1844360FUSE (3873))   \n  Email: [info@appdome.com](mailto:info@appdome.com)\n\nISRAEL OFFICE\n\n* 21 HaArba'a Street,\n* Phone: [+97235568332](tel:+97235568332)   \n  Email: [info@appdome.com](mailto:info@appdome.com)\n\nSearch for:\n\nFollow us\n\n\u00a92026 Appdome, Inc. All rights reserved. This Website requires the use of technical cookies and, with your consent, profiling, and third-party analytics to improve your experience.  \n If you continue to use our Website, or by clicking any items of our Website, you agree to this.\n\nWe use cookies to ensure that we give you the best experience on our website.\nIf you continue to use this site we will assume that you are happy with it.\nOk\n\n ![](https://px.ads.linkedin.com/collect/?pid=3167484&fmt=gif) \n\n## Search Appdome Solutions\n\nSearch\n\nSearch\n\n[![mobile app protection best practices](https://www.appdome.com/wp-content/uploads/2026/01/Mobile-App-Protection-Best-Practices-for-Developers-in-2026-170x111.png)](https://www.appdome.com/dev-sec-blog/mobile-app-protection-best-practices-for-developers/)\n\n### [Mobile App Protection Best Practices for Developers in 2026](https://www.appdome.com/dev-sec-blog/mobile-app-protection-best-practices-for-developers/)\n\nMobile app protection best practices for developers in 2026. Learn how to protect apps from AI malware, bots, ATO, and fraud \u2014 automated with Appdome.\n\nJan Sysmans \n\nJanuary 5, 2026\n\n[![Mobile App Attack Vectors](https://www.appdome.com/wp-content/uploads/2026/01/mobile-app-attack-vectors-170x111.png)](https://www.appdome.com/dev-sec-blog/top-mobile-app-attack-vectors/)\n\n### [Top 10 Mobile App Attack Vectors in 2026 And the Defense Architecture Required to Stop Them](https://www.appdome.com/dev-sec-blog/top-mobile-app-attack-vectors/)\n\nAI malware, deepfakes, and automated bots are the top mobile app attack vectors in 2026. Discover how to stop them with Appdome\u2019s defense architecture defense.\n\nJan Sysmans \n\nJanuary 1, 2026\n\n[![G2 Customer Reviews](https://www.appdome.com/wp-content/uploads/2025/12/G2-Reviews_-2025-Was-a-Banner-Year-for-Appdome-170x111.png)](https://www.appdome.com/dev-sec-blog/g2-customer-reviews-2025-banner-year-appdome/)\n\n### [G2 Customer Reviews Reveal 2025 Was a Banner Year for Appdome](https://www.appdome.com/dev-sec-blog/g2-customer-reviews-2025-banner-year-appdome/)\n\nG2 customer reviews show that 2025 marked a pivotal year for Appdome. The platform gained momentum as enterprises standardized on AI-native automation for mobile security, fraud prevention, and bot defense.\n\nTom Tovar \n\nDecember 28, 2025\n\n[![Android Bootloader Integrity Explained](https://www.appdome.com/wp-content/uploads/2025/12/android-bootloader-integrity-explained-170x111.png)](https://www.appdome.com/dev-sec-blog/android-bootloader-integrity-explained/)\n\n### [Why \u2018Unlocked Bootloader\u2019 Is a Broken Android Security Model](https://www.appdome.com/dev-sec-blog/android-bootloader-integrity-explained/)\n\nAndroid bootloader integrity is often reduced to a locked or unlocked state. This article explains why that model fails and how contextual bootloader signals improve identity and session trust.\n\nLiron Dror \n\nDecember 24, 2025\n\n[Dev+Sec Blog](/dev-sec-blog)\n\n-->"
}